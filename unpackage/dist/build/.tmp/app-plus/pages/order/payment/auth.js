(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/payment/auth"],{"2fe0":function(e,t,n){"use strict";var r,o=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"b",function(){return o}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return r})},"679c":function(e,t,n){"use strict";n.r(t);var r=n("7671"),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t["default"]=o.a},7671:function(e,t,n){"use strict";(function(e,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(d){return void n(d)}s.done?t(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,u,"next",e)}function u(e){a(i,r,o,s,u,"throw",e)}s(void 0)})}}var u={data:function(){return{type:"",openid:"",orderId:"",state:""}},onLoad:function(e){this.orderId=e.order_id,this.money=Number(e.money),this.type=Number(e.type),this.uid=Number(e.uid),this.state=this.$common.getQueryString("state"),this.getCode()},methods:{getCode:function(){var e=this.$common.getQueryString("code");e&&this.getOpenId(e)},getOpenId:function(){var t=s(o.default.mark(function t(n){var i,a;return o.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e("log",n," at pages\\order\\payment\\auth.vue:34"),i={code:n,scope:2,state:this.state},t.next=4,Api.apiCall("get",Api.order.authCodeToOpenid,i);case 4:a=t.sent,e("log",a," at pages\\order\\payment\\auth.vue:42"),a?(this.login(data),e("log",data," at pages\\order\\payment\\auth.vue:45"),this.$db.set("userInfos",data.userInfo),this.$db.set("token",data.tokenHead+data.token),r.switchTab({url:"/pages/index/index"})):this.$common.errorToShow(a);case 7:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),checkWXJSBridge:function(e){var t=this,n=setInterval(function(){"undefined"!=typeof window.WeixinJSBridge&&(clearTimeout(n),t.onBridgeReady(e))},200)},onBridgeReady:function(e){var t=this;window.WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appid,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},function(n){"get_brand_wcpay_request:ok"===n.err_msg?t.$common.successToShow("支付成功"):"get_brand_wcpay_request:cancel"===n.err_msg?t.$common.errorToShow("取消支付"):t.$common.errorToShow("支付失败"),setTimeout(function(){t.$common.redirectTo("/pages/order/payment/result?id="+e.id)},1e3)})},toPayHandler:function(e){var t=this,n={payment_code:e,payment_type:this.type};n["ids"]=1==this.type||5==this.type||6==this.type?this.orderId:this.uid,1==this.type&&this.orderId?this.openid&&(n["params"]={trade_type:"JSAPI_OFFICIAL",openid:this.openid}):2==this.type&&this.money?this.openid&&(n["params"]={trade_type:"JSAPI_OFFICIAL",money:this.money,openid:this.openid}):5!=this.type&&6!=this.type||!this.recharge||(n["params"]={trade_type:"JSAPI_OFFICIAL",openid:this.openid,formid:this.orderId}),this.$api.pay(n,function(e){if(200==e.code){var n=e.data;t.checkWXJSBridge(n)}else t.$common.errorToShow(e.msg)})}}};t.default=u}).call(this,n("0de9")["default"],n("6e42")["default"])},"7c26":function(e,t,n){"use strict";(function(e){n("e160"),n("921b");r(n("66fd"));var t=r(n("e276"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},8038:function(e,t,n){},e276:function(e,t,n){"use strict";n.r(t);var r=n("2fe0"),o=n("679c");for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n("f79e");var a,s=n("f0c5"),u=Object(s["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],a);t["default"]=u.exports},f79e:function(e,t,n){"use strict";var r=n("8038"),o=n.n(r);o.a}},[["7c26","common/runtime","common/vendor"]]]);